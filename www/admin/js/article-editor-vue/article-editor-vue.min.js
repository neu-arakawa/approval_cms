var ArticleEditor=function(){function t(t,e){void 0===t&&(t=8),void 0===e&&(e="alphanumeric");var i;"alphanumeric"===e?i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789":"numeric"===e&&(i="0123456789");for(var o=i.length,n="",a=0;a<t;a++)n+=i[Math.floor(Math.random()*o)];return n}function e(t){var e=["B","KB","MB","GB","TB","PB"],t=t.toUpperCase(),i=e.join("|"),o=new RegExp("^(([1-9]\\d*|0)(\\.\\d+)?)\\s*("+i+"?)$");if(t.match(o)){var t=RegExp.$1,n=RegExp.$4,a=e.indexOf(n);return t=Math.floor(t*Math.pow(1024,a))}return null}function i(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace("/ /","&nbsp;"):t}function o(t){return t?t.replace(/<script(\s+.+?)?>(.+?)<\/script(\s+.?)?>/g,"").replace(/<div(\s+.+?)?>(.+?)<\/div(\s+.?)?>/g,""):t}function n(t){return t?t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g,""):t}function a(t){return t?(t=t.replace(/(<div.*?>|<p.*?>)/gi,"<br>"),t=t.replace(/(<\/div\s*>|<\/p\s*>)/gi,""),t=t.replace(/^<br(\s+[^>]+)?(\s*\/)?>/i,"")):t}function t(t,e){void 0===t&&(t=8),void 0===e&&(e="alphanumeric");var i;"alphanumeric"===e?i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789":"numeric"===e&&(i="0123456789");for(var o=i.length,n="",a=0;a<t;a++)n+=i[Math.floor(Math.random()*o)];return n}function s(t){var e=document.getElementsByTagName("head").item(0),i=document.createElement("link");i.rel="stylesheet",i.href=t,i.type="text/css",e.appendChild(i)}function r(t,e,i){"string"==typeof t&&(t=[t]);var o=[];if(t.forEach(function(e){-1===f.indexOf(t)&&o.push(e)}),0!==o.length){var n=setTimeout(function(){i&&i()},5e3),a=0;o.forEach(function(i){var s=document.getElementsByTagName("head").item(0),r=document.createElement("script");r.src=i,s.appendChild(r),f.push(i),r.onload=function(){++a===o.length&&(clearTimeout(n),e&&e(t));var l=f.indexOf(i);-1!==l&&f.splice(l,1),r.onload=null,s&&r.parentNode&&s.removeChild(r)}})}else e&&e()}function l(t){return JSON.parse(JSON.stringify(t))}function d(t){if(!c)return!1;"undefined"==typeof console||void 0===console.log?console={}:console.log(t)}var c=!0,p=function(){var t;if(document.currentScript)t=document.currentScript.src;else{var e=document.getElementsByTagName("script");t=(t=e[e.length-1]).src}if(t&&t.match(/^(.+?)([^\/]+?)$/))return RegExp.$1}(),u=window.File&&window.FileReader&&window.FileList&&window.Blob,m=function(){var t=window.navigator.userAgent.toLowerCase();return-1!==t.indexOf("edge")?"edge":-1!==t.indexOf("iemobile")?"iemobile":-1!==t.indexOf("trident/7")?"ie":-1!==t.indexOf("msie")&&-1===t.indexOf("opera")?"ie":-1!==t.indexOf("chrome")&&-1===t.indexOf("edge")?"chrome":-1!==t.indexOf("safari")&&-1===t.indexOf("chrome")?"safari":-1!==t.indexOf("opera")?"opera":-1!==t.indexOf("firefox")?"firefox":null}(),g=("edge"==m||"chrome"==m||"safari"==m||"firefox"==m||"ie"==m&&function(){var t=window.navigator.userAgent.toLowerCase(),e=window.navigator.appVersion.toLowerCase();if(-1!==t.indexOf("trident/7"))return 11;if(-1!==t.indexOf("msie")&&-1===t.indexOf("opera")){if(-1!==e.indexOf("msie 6."))return 6;if(-1!==e.indexOf("msie 7."))return 7;if(-1!==e.indexOf("msie 8."))return 8;if(-1!==e.indexOf("msie 9."))return 9;if(-1!==e.indexOf("msie 10."))return 10}return null}()>=10)&&u;s(p+"css/style.css"),s(p+"css/ve.css"),s(p+"css/vue-transition.css"),s(p+"lib/font-awesome/font-awesome.min.css");var h=function(s,c){function u(){if(!g.vue&&(g.vue=new Vue({el:s,template:'        <div class="article-editor" v-on:dragover.prevent.stop="onFileDrag">          <separator v-on:label-drop-on-separator="onItemDrop" v-on:separator-click="onSeparatorClick" />          <transition name="tips" tag="div">          <div class="tips" v-if="!items.length"><div class="separator" v-on:click.prevent=""><button tabindex="-1"><span>挿入</span></button></div>をクリックすると{{tipsLabel}}</div>          </transition>          <transition-group name="item" tag="div">            <component v-bind:is="item.component" v-for="(item, index) in items" :key="item.id" v-bind:item=item v-on:item-delete="deleteItem" v-on:separator-click="onSeparatorClick" v-on:item-dragstart="onItemDragstart" v-on:item-dragend="onItemDragend" v-on:item-drop="onItemDrop" v-on:table-header-menu-click="onTableHeaderMenuClick" />          </transition-group>          <tableMenu v-bind:data="tableMenu" v-on:menu-click="doTableAction" ref="tableMenu" />          <itemMenu v-bind:data="itemMenu" v-on:menu-click="addItem" ref="itemMenu" />          <input v-bind:name="inputName" type="hidden" ref="sendData" />        </div>',data:function(){return{items:[],itemMenu:{show:!1,position:{x:0,y:0},size:{width:0,height:0}},tableMenu:{show:!1,direction:null,mode:"row"},inputName:null,tipsLabel:null}},components:{separator:k,itemMenu:I,tableMenu:F,textItem:M,VETextItem:R,imageItem:S,imageOnlyItem:L,linkItem:H,listItem:O,tableItem:_,htmlItem:U},created:function(){this.items=W,this.inputName=j;var t=[];g.options.types.forEach(function(e){t.push(g.options.typeNames[e])}),1===t.length?this.tipsLabel="その位置に"+t[0]+"が追加されます。":this.tipsLabel="その位置に選んだ要素（"+t.join("・")+"）が追加されます。"},mounted:function(){var t=$(this.$el).closest("form"),e=this;t&&t.bind("submit",function(t){var i=g.getSendData();$(e.$refs.sendData).val(i)}),g.options.onLoad&&g.options.onLoad.call(g),g.options.onUpdate&&g.options.onUpdate.call(g)},methods:{addItem:function(e){"text"===e&&g.options.inlineVe&&(e="ve-text");var i=w?this.items.indexOf(w)+1:0,o=l(q[e]);"list"===e&&(o.rows[0].id=t()),o.id=t(),this.items.splice(i,0,o),w=null},deleteItem:function(t){if(!confirm("要素を削除します。よろしいですか？"))return!1;var e=this.items.indexOf(t);-1!==e&&this.items.splice(e,1)},onSeparatorClick:function(t,e){if(w=t,this.itemMenu.show=!1,1!==g.options.types.length){this.itemMenu.show=!0,this.itemMenu.direction="below";var i=$(this.$refs.itemMenu.$el),o=$(this.$el),n=e.pageX-o.offset().left,a=e.pageY-o.offset().top;n-=i.outerWidth()/2;var s=e.pageX-i.outerWidth()/2;s<0&&(n=-1*o.offset().left),(s=e.pageX+i.outerWidth()/2)>$(document).width()&&(n-=s-$(document).width());e.pageY+i.outerHeight()+30>$(document).height()&&(a-=i.outerHeight(),this.itemMenu.direction="above"),"above"==this.itemMenu.direction?a-=15:a+=30,i.css({left:n+"px",top:a+"px"}),$(document).bind("click",this.hideItemMenu)}else this.addItem(g.options.types[0])},hideItemMenu:function(){this.itemMenu.show=!1,w=null,$(document).unbind("click",this.hideItemMenu)},doTableAction:function(t){b&&b.doAction(t),b=null},onTableHeaderMenuClick:function(t,e,i){$(document).unbind("click",this.hideTableMenu),b=t,this.tableMenu.show=!0,this.tableMenu.mode=e,this.tableMenu.direction="above";var o=$(this.$refs.tableMenu.$el),n=$(this.$el),a=this;setTimeout(function(){d({pageX:i.pageX,pageY:i.pageY,menuH:o.height()});var t=i.pageX-n.offset().left,e=i.pageY-n.offset().top-o.height();t-=o.outerWidth()/2;var s=i.pageX-o.outerWidth()/2;s<0&&(t=-1*n.offset().left),(s=i.pageX+o.outerWidth()/2)>$(document).width()&&(t-=s-$(document).width());i.pageY-o.outerHeight()<0&&(e+=o.outerHeight(),a.tableMenu.direction="below"),"above"==a.tableMenu.direction?e-=25:e+=20,o.css({left:t+"px",top:e+"px"}),a.tableMenu.show=!0,$(document).bind("click",a.hideTableMenu)},0)},hideTableMenu:function(){this.tableMenu.show=!1,$(document).unbind("click",this.hideTableMenu),b&&b.doAction(null),b=null},onFileDrag:function(t){t.dataTransfer.dropEffect="none"},onItemDragstart:function(t){f=t},onItemDragend:function(t){f=null},onItemDrop:function(t){if(!f)return!1;var e=t?this.items.indexOf(t)+1:0,i=this.items.indexOf(f);if(f=null,e===i||e===i+1)return!1;var o=this.items.splice(i,1);e=t?this.items.indexOf(t)+1:0,this.items.splice(e,0,o[0])}}}),g.options.onUpdate)){var e=null;g.vue.$watch("items",function(){e&&clearTimeout(e),e=setTimeout(function(){g.options.onUpdate.call(g)},g.options.updateInterval)},{deep:!0})}}var m=$(s);if(!m.closest("form").length)return alert("[ArticleEditor] 指定の要素がフォーム要素に含まれないため、正常に動作しません"),null;var g=this,v={maxFileSize:"2MB",types:["big-heading","mid-heading","small-heading","text","image-only","image","link","list","table","html"],typeNames:{"big-heading":"大見出し","mid-heading":"中見出し","small-heading":"小見出し",text:"テキスト","image-only":"画像のみ",image:"画像+テキスト",link:"リンク",list:"リスト",table:"表組み",html:"HTML"},allowCssClass:!1,allowImageAlt:!1,bigHeadingTag:"h3",midHeadingTag:"h4",smallHeadingTag:"h5",textTag:"p",imageTag:"div",imageTagClass:"image-wrap",linkTag:"div",linkTagClass:"link-wrap",listTag:"ul",tableTag:"table",tableDefaultColNum:2,tableMaxRow:50,tableMaxCol:10,htmlTag:"div",htmlTagClass:"html-wrap",imageOnlyTagClass:"image-only",wholeWrapTag:"div",wholeWrapTagClass:"ve",imageTypes:["jpg","jpeg","jpe","gif","png"],fileTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","zip","mp4","jpg","jpeg","jpe","gif","png"],imgPlaceholderText:"回り込みテキストを入力します。回り込みテキストを入力します。回り込みテキストを入力します。回り込みテキストを入力します。回り込みテキストを入力します。回り込みテキストを入力します。",maxTextAreaHeight:400,uploaderDomain:null,uploaderPath:"/uploader",uploaderDir:"/",inlineVe:!0,allowHtmlInText:!1,veInlineClasses:{bold:"太字",highlight:"ハイライト",link:"リンク"},onLoad:null,onUpdate:null,updateInterval:0};this.options=l(v);var f=null,w=null,b=null;for(var x in c)this.options[x]=c[x];for(var x in v){var C="data-"+function(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.charAt(0).toLowerCase()})}(x),D=m.attr(C);if(D){D=D.replace(/\'/g,'"');try{D=JSON.parse(D)}catch(t){}finally{this.options[x]=D}}}this.options.uploaderPath.match(/\/$/)||(this.options.uploaderPath=this.options.uploaderPath+"/"),this.options.uploaderDir.match(/^(\/*)(.*?)(\/*)$/)&&(this.options.uploaderDir=RegExp.$2),this.options.uploaderDomain&&this.options.uploaderDomain.match(/^(.*?)(\/*)$/)&&(this.options.uploaderDomain=RegExp.$1);var T={data:function(){return{dragging:!1}},computed:{isCssClassEnabled:function(){return g.options.allowCssClass}},methods:{onLabelDragstart:function(t){t.dataTransfer.setData("text","element"),t.dataTransfer.effectAllowed="move",this.dragging=!0,this.$emit("item-dragstart",this.item)},onLabelDragend:function(t){this.dragging=!1,this.$emit("item-dragend",this.item)},onLabelDrop:function(){this.$emit("item-drop",this.item)},onSeparatorClick:function(t,e){this.$emit("separator-click",this.item,e)},onItemDelete:function(t){this.$emit("item-delete",this.item)}}},k={template:'<div class="separator" v-bind:class="{dragover:dragover}" v-on:click.prevent.stop="onClick" v-on:dragover.prevent.stop="onDragover" v-on:dragleave="onDragleave" v-on:drop.prevent.stop="onDrop"><button tabindex="-1"><span>挿入</span></button></div>',data:function(){return{dragover:!1}},methods:{onClick:function(t){this.$emit("separator-click",null,t)},onDragover:function(t){if(!f)return!1;this.dragover=!0,t.dataTransfer.dropEffect="move"},onDragleave:function(t){if(!f)return!1;this.dragover=!1},onDrop:function(t){if(!f)return!1;this.dragover=!1,this.$emit("label-drop-on-separator")}}},y='<div class="item-menu" v-bind:class="[data.direction,{show: data.show}]"><ul>';g.options.types.forEach(function(t){var e=g.options.typeNames[t];y+='<li data-type="'+t+'" v-on:click="onMenuClick">'+e+"</li>"});var I={template:y+="</ul></div>",props:["data"],computed:{},mounted:function(){this.data.size.width=this.$el.clientWidth,this.data.size.height=this.$el.clientHeight},methods:{onMenuClick:function(t){var e=$(t.target).attr("data-type");this.$emit("menu-click",e)}}},N={template:'<div contenteditable="true" v-bind:class="{placeholded: placeholded}" v-on:input="onTextChange" v-on:focus="onFocus" v-on:blur="onBlur" v-on:paste.prevent="onTextPaste" ref="inputElement"></div>',props:["text","isPlaceholderEnabled"],data:function(){return{placeholded:!1}},created:function(){},mounted:function(){var t=$(this.$refs.inputElement);this.text?t.html("<p>"+this.text+"</p>"):t.html("<br>"),this.onBlur()},computed:{},methods:{onTextChange:function(t){this.$emit("input",$(this.$refs.inputElement).html())},onFocus:function(t){this.$emit("focus");var e=$(this.$refs.inputElement);this.isPlaceholderEnabled&&e.text()===g.options.imgPlaceholderText&&(this.placeholded=!1,e.html("<br>"))},onBlur:function(t){this.onTextChange(t),this.$emit("blur");var e=$(this.$refs.inputElement);this.isPlaceholderEnabled&&!e.text()&&(this.placeholded=!0,setTimeout(function(){e.html(g.options.imgPlaceholderText)},0))},onTextPaste:function(t){var e;if(e=window.clipboardData?window.clipboardData.getData("text"):t.clipboardData.getData("text/plain"),document.selection){(o=document.selection.createRange()).text=e}else{var i=window.getSelection(),o=i.getRangeAt(0),n=document.createTextNode(e);o.deleteContents(),o.insertNode(n),i.removeAllRanges()}}}},E={template:'<div class="ve"              contenteditable="false"              v-bind:class="{placeholded: placeholded}"              v-on:input="onTextChange"              v-on:blur="onBlur"              v-on:focus="onFocus"              ref="inputElement"></div>',props:["text","isPlaceholderEnabled"],data:function(){return{placeholded:!1,veMenuSelector:".mce-tinymce"}},created:function(){},mounted:function(){var t=$(this.$refs.inputElement);this.text?t.html(this.text):t.html("<br>"),g.options.inlineVe&&this.loadTinyMCE(),this.onBlur()},computed:{},methods:{init:function(){var t,e=this,i=[];for(var o in g.options.veInlineClasses){var n=g.options.veInlineClasses[o];"link"===o?t="styleselect link unlink | removeformat":i.push({title:n,inline:"span",classes:o})}t||(t="styleselect | removeformat");var a=0,s=setInterval(function(){"undefined"!=typeof tinymce&&tinymce.init({target:e.$el,theme:"inlite",skin:"custom",language:"ja",menubar:!1,statusbar:!1,plugins:"link paste",insert_toolbar:"",selection_toolbar:t,inline:!0,paste_as_text:!0,paste_data_images:!1,forced_root_block:!1,keep_styles:!1,hidden_input:!1,content_css:[],branding:!1,elementpath:!1,style_formats:i,convert_urls:!1,relative_urls:!0,init_instance_callback:function(t){clearInterval(s),e.$emit("ve-init")}}),++a>=20&&clearInterval(s)},500)},onTextChange:function(t){var e=$(this.$refs.inputElement).html();this.$emit("input",e)},onFocus:function(t){this.$emit("focus");var e=$(this.$refs.inputElement);this.isPlaceholderEnabled&&e.text()===g.options.imgPlaceholderText&&(this.placeholded=!1,e.html("<br>"))},onBlur:function(t){this.onTextChange(t),this.$emit("blur");var e=$(this.$refs.inputElement);this.isPlaceholderEnabled&&!e.text()&&(this.placeholded=!0,setTimeout(function(){e.html(g.options.imgPlaceholderText)},0))},loadTinyMCE:function(){var t=this;"undefined"==typeof tinymce?r(p+"lib/tinymce/tinymce.min.js",function(){t.init(t)}):t.init(t)}}},M={template:'  <div class="item-wrap">    <div class="item text" v-bind:class="[item.type, {dragging:dragging}]">      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">{{labelName}}</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <textarea v-model="item.text" v-on:input="onInput" ref="inputElement" />      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],components:{separator:k},mixins:[T],mounted:function(){var t=this.$refs.inputElement;if(document.createEvent){(e=document.createEvent("HTMLEvents")).initEvent("input",!0,!0),t.dispatchEvent(e)}else{var e=document.createEventObject();t.fireEvent("oninput",e)}},computed:{labelName:function(){return g.options.typeNames[this.item.type]}},methods:{onInput:function(t){var e=window.getComputedStyle(t.target),i=e.lineHeight.split("px")[0];e.paddingTop.split("px")[0],e.paddingBottom.split("px")[0];if(t.target.scrollHeight>t.target.offsetHeight)t.target.style.height=t.target.scrollHeight+3+"px";else for(var o;;){if(o=t.target.style.height.split("px")[0],t.target.style.height=o-i+"px",t.target.scrollHeight>t.target.offsetHeight){t.target.style.height=t.target.scrollHeight+3+"px";break}break}}}},R={template:'  <div class="item-wrap">    <div class="item ve-text" v-bind:class="{\'ve-unload\': !item.veInited, dragging:dragging}">      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">テキスト</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <visualeditor          v-bind:text=item.text          v-bind:isPlaceholderEnabled=false          v-on:input="onTextChange"          v-on:ve-init="onVEInit" />      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  <div>',props:["item"],created:function(){},components:{visualeditor:E,separator:k},mixins:[T],computed:{labelName:function(){return g.options.typeNames[this.item.type]}},methods:{onTextChange:function(t){this.item.text=t},onVEInit:function(){this.item.veInited=!0}}},S={template:'  <div class="item-wrap">    <div class="item image" v-bind:class="{\'ve-unload\': !item.veInited, nofile: !item.image, dragover:dragover, dragging:dragging, focus:focus}" v-on:dragover.prevent.stop="onDragover" v-on:dragleave="onDragleave" v-on:drop.prevent.stop="onDrop">      <div class="loading" v-if="isLoadingFile"><div class="progress-wrap"><div class="progress" v-bind:style="{width: uploadProgress + \'%\'}"></div></div></div>      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">画像</label>        <div class="align">          <input type="radio" value="left" v-model="item.align" v-bind:id="randomID[0]" /><label v-bind:for="randomID[0]"></label>          <input type="radio" value="center" v-model="item.align" v-bind:id="randomID[1]" /><label v-bind:for="randomID[1]"></label>          <input type="radio" value="right" v-model="item.align" v-bind:id="randomID[2]" /><label v-bind:for="randomID[2]"></label>        </div>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <div class="dnd" v-if="isDndSupported" v-on:dblclick="selectFile">          <div class="msg">画像をドラッグ＆ドロップ</div>        </div>        <div class="content">          <div class="img" v-bind:class="item.align">            <img v-bind:src="item.image" v-on:dblclick="selectFile" draggable="false" />          </div>          <component            v-bind:is="inputComponent"            v-bind:isPlaceholderEnabled=true            class="text"            v-bind:text=item.text            v-on:input="onTextChange"            v-on:ve-init="onVEInit"            v-on:focus="onFocus"            v-on:blur="onBlur" />        </div>        <div class="alt-wrap" v-if="isAltEnabled">          <label :for="item.id+\'_alt\'">ALT</label>          <input type="text" v-model="item.altName" :id="item.id+\'_alt\'" />        </div>        <button class="remove" tabindex="-1" v-on:click.prevent="onFileDelete">画像をクリア</button>        <button class="uploader" tabindex="-1" v-on:click.prevent="selectFile">アップロード済みの画像から選択</button>      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],data:function(){return{randomID:[],dragover:!1,isDndSupported:!g.options.uploaderDomain,isLoadingFile:!1,uploadProgress:0,inputComponent:g.options.inlineVe?"visualeditor":"plaintexteditor",focus:!1}},components:{visualeditor:E,plaintexteditor:N,separator:k},mixins:[T],created:function(){},mounted:function(){for(var e=0;e<3;e++)this.randomID.push("image-align-"+t(6,"numeric"))},computed:{isAltEnabled:function(){return g.options.allowImageAlt}},methods:{canDrop:function(){return this.isDndSupported&&!f},selectFile:function(t){return h.showUploader(g.options.uploaderDomain,g.options.uploaderPath,g.options.uploaderDir,this.setImage),!1},onTextChange:function(t){this.item.text=t},setImage:function(t){var e=g.options.imageTypes;if(t&&e){var i=new RegExp(".("+e.join("|")+")$");if(!t.match(i))return alert("画像の種類は "+e.join("・")+" のいずれかである必要があります"),!1}this.item.image=t},onFileDelete:function(){if(!confirm("画像をクリアします。よろしいですか？\n(アップロードされたファイルは削除されません)"))return!1;this.setImage(null)},onVEInit:function(){this.item.veInited=!0},onDragover:function(t){if(!this.canDrop())return!1;t.dataTransfer.dropEffect="copy",this.dragover=!0},onDragleave:function(t){if(!this.canDrop())return!1;this.dragover=!1},onDrop:function(t){if(!this.canDrop())return!1;var i=this;this.dragover=!1,this.isLoadingFile=!0,this.uploadProgress=0;var o=t.dataTransfer.files;file_count=o.length;var n="";0==file_count?n="画像が指定されていません":file_count>1&&(n="アップロードできる画像は1個までです");var a=o[0];!n&&a.size>e(g.options.maxFileSize)&&(n="画像のサイズが上限("+g.options.maxFileSize+")を超過しています");var s=g.options.imageTypes;if(!n&&s){var r=new RegExp(".("+s.join("|")+")$");a.name.match(r)||(n="画像の種類は "+s.join("・")+" のいずれかである必要があります")}if(n)return this.isLoadingFile=!1,alert(n),!1;h.upload.call(this,a,g.options.uploaderPath,g.options.uploaderDir,function(t){i.isLoadingFile=!1,i.setImage(t)},function(t){i.isLoadingFile=!1,alert(t)},function(t){i.uploadProgress=100*t})},onFocus:function(){this.focus=!0},onBlur:function(){this.focus=!1}}},L={template:'  <div class="item-wrap">    <div class="item image" v-bind:class="{\'ve-unload\': !item.veInited, nofile: !item.image, dragover:dragover, dragging:dragging, focus:focus}" v-on:dragover.prevent.stop="onDragover" v-on:dragleave="onDragleave" v-on:drop.prevent.stop="onDrop">      <div class="loading" v-if="isLoadingFile"><div class="progress-wrap"><div class="progress" v-bind:style="{width: uploadProgress + \'%\'}"></div></div></div>      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">画像のみ</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <div class="dnd" v-if="isDndSupported" v-on:dblclick="selectFile">          <div class="msg">画像をドラッグ＆ドロップ</div>        </div>        <div class="content">          <div class="img-only">            <img v-bind:src="item.image" v-on:dblclick="selectFile" draggable="false" />          </div>        </div>        <div class="alt-wrap" v-if="isAltEnabled">          <label :for="item.id+\'_alt\'">ALT</label>          <input type="text" v-model="item.altName" :id="item.id+\'_alt\'" />        </div>        <button class="remove" tabindex="-1" v-on:click.prevent="onFileDelete">画像をクリア</button>        <button class="uploader" tabindex="-1" v-on:click.prevent="selectFile">アップロード済みの画像から選択</button>      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],data:function(){return{randomID:[],dragover:!1,isDndSupported:!g.options.uploaderDomain,isLoadingFile:!1,uploadProgress:0,inputComponent:g.options.inlineVe?"visualeditor":"plaintexteditor",focus:!1}},components:{visualeditor:E,plaintexteditor:N,separator:k},mixins:[T],created:function(){},mounted:function(){for(var e=0;e<3;e++)this.randomID.push("image-align-"+t(6,"numeric"))},computed:{isAltEnabled:function(){return g.options.allowImageAlt}},methods:{canDrop:function(){return this.isDndSupported&&!f},selectFile:function(t){return h.showUploader(g.options.uploaderDomain,g.options.uploaderPath,g.options.uploaderDir,this.setImage),!1},onTextChange:function(t){this.item.text=t},setImage:function(t){var e=g.options.imageTypes;if(t&&e){var i=new RegExp(".("+e.join("|")+")$");if(!t.match(i))return alert("画像の種類は "+e.join("・")+" のいずれかである必要があります"),!1}this.item.image=t},onFileDelete:function(){if(!confirm("画像をクリアします。よろしいですか？\n(アップロードされたファイルは削除されません)"))return!1;this.setImage(null)},onVEInit:function(){this.item.veInited=!0},onDragover:function(t){if(!this.canDrop())return!1;t.dataTransfer.dropEffect="copy",this.dragover=!0},onDragleave:function(t){if(!this.canDrop())return!1;this.dragover=!1},onDrop:function(t){if(!this.canDrop())return!1;var i=this;this.dragover=!1,this.isLoadingFile=!0,this.uploadProgress=0;var o=t.dataTransfer.files;file_count=o.length;var n="";0==file_count?n="画像が指定されていません":file_count>1&&(n="アップロードできる画像は1個までです");var a=o[0];!n&&a.size>e(g.options.maxFileSize)&&(n="画像のサイズが上限("+g.options.maxFileSize+")を超過しています");var s=g.options.imageTypes;if(!n&&s){var r=new RegExp(".("+s.join("|")+")$");a.name.match(r)||(n="画像の種類は "+s.join("・")+" のいずれかである必要があります")}if(n)return this.isLoadingFile=!1,alert(n),!1;h.upload.call(this,a,g.options.uploaderPath,g.options.uploaderDir,function(t){i.isLoadingFile=!1,i.setImage(t)},function(t){i.isLoadingFile=!1,alert(t)},function(t){i.uploadProgress=100*t})},onFocus:function(){this.focus=!0},onBlur:function(){this.focus=!1}}},H={template:'  <div class="item-wrap">    <div class="item link" v-bind:class="{dragover:dragover, dragging:dragging}" v-on:dragover.prevent.stop="onDragover" v-on:dragleave="onDragleave" v-on:drop.prevent.stop="onDrop">      <div class="loading" v-if="isLoadingFile"><div class="progress-wrap"><div class="progress" v-bind:style="{width: uploadProgress + \'%\'}"></div></div></div>      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">リンク</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <div class="wrap">          <ul>            <li><label>URL</label><input type="text" placeholder="http://www.example.com/" class="url" v-model="item.url" v-on:keydown.enter.prevent="" /></li>            <li><label>テキスト</label><input type="text" placeholder="リンクに設定するテキストを入力" class="text" v-model="item.text" v-on:keydown.enter.prevent="" /></li>            <li class="link-target"><label><input type="checkbox" v-model="item.newWindow" />別ウィンドウで開く</label></li>          </ul>        </div>        <button class="uploader" tabindex="-1" v-on:click.prevent="onUploaderClick">アップロード済みのファイルから選択</button>      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],components:{separator:k},mixins:[T],data:function(){return{dragover:!1,isDndSupported:!g.options.uploaderDomain,isLoadingFile:!1,uploadProgress:0}},methods:{canDrop:function(){return this.isDndSupported&&!f},onUploaderClick:function(t){return h.showUploader(g.options.uploaderDomain,g.options.uploaderPath,g.options.uploaderDir,this.setFile),!1},setFile:function(t){var e=g.options.fileTypes;if(e){var i=new RegExp(".("+e.join("|")+")$");if(!t.match(i))return alert("ファイルの種類は "+e.join("・")+" のいずれかである必要があります"),!1}this.item.url=t},onDragover:function(t){if(!this.canDrop())return!1;t.dataTransfer.dropEffect="copy",this.dragover=!0},onDragleave:function(t){if(!this.canDrop())return!1;this.dragover=!1},onDrop:function(t){if(!this.canDrop())return!1;var i=this;this.dragover=!1,this.isLoadingFile=!0,this.uploadProgress=0;var o=t.dataTransfer.files;file_count=o.length;var n="";0==file_count?n="ファイルが指定されていません":file_count>1&&(n="アップロードできるファイルは1個までです");var a=o[0];!n&&a.size>e(g.options.maxFileSize)&&(n="ファイルのサイズが上限("+g.options.maxFileSize+")を超過しています");var s=g.options.fileTypes;if(!n&&s){var r=new RegExp(".("+s.join("|")+")$");a.name.match(r)||(n="ファイルの種類は "+s.join("・")+" のいずれかである必要があります")}if(n)return this.isLoadingFile=!1,alert(n),!1;h.upload(a,g.options.uploaderPath,g.options.uploaderDir,function(t){i.isLoadingFile=!1,i.setFile(t)},function(t){i.isLoadingFile=!1,alert(t)},function(t){i.uploadProgress=100*t})}}},P={template:'    <div class="list-separator" v-bind:class="{dragover:dragover}" v-on:dragover.prevent.stop="onDragover" v-on:dragleave="onDragleave" v-on:drop.prevent.stop="onDrop"></div>',props:["droppingRow"],data:function(){return{dragover:!1}},methods:{canDrop:function(){return!!this.droppingRow},onDragover:function(t){if(!this.canDrop())return!1;this.dragover=!0,t.dataTransfer.dropEffect="move"},onDragleave:function(t){if(!this.canDrop())return!1;this.dragover=!1},onDrop:function(t){if(!this.canDrop())return!1;this.dragover=!1,this.$emit("row-drop")}}},O={template:'  <div class="item-wrap">    <div class="item list" v-bind:class="{dragging:dragging}">      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">リスト</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <div class="list-wrap">          <listSeparator v-bind:droppingRow="droppingRow" v-on:row-drop="onRowDrop" />          <transition-group name="list-row" tag="div">          <row v-for="(row, index) in item.rows" v-bind:row=row v-bind:droppingRow="droppingRow" :key="row.id" v-on:row-delete="deleteRow" v-on:row-dragstart="onRowDragstart" v-on:row-dragend="onRowDragend" v-on:row-drop="onRowDrop" />          </transition-group>        </div>        <div class="ctl">          <button class="add" tabindex="-1" v-on:click.prevent="addRow">行の追加</button>        </div>      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],components:{row:{template:'  <div class="list-row-wrap">    <div class="row" v-bind:class="{dragging:dragging, focus:focus}" v-bind:draggable="draggable" v-on:dragstart="onRowDragstart" v-on:dragend="onRowDragend">      <label v-on:mouseover="onLabelMouseover" v-on:mouseout="onLabelMouseout"></label>      <input type="text" v-model="row.text" v-on:focus="onFocus" v-on:blur="onBlur" v-on:keydown.enter.prevent="" />      <button class="del" tabindex="-1" v-on:click.prevent="onRowDelete"></button>    </div>    <listSeparator v-bind:droppingRow="droppingRow" v-on:row-drop="onRowDrop" />  </div>',props:["row","droppingRow"],components:{listSeparator:P},data:function(){return{dragging:!1,draggable:!1,focus:!1}},methods:{onRowDelete:function(){this.$emit("row-delete",this.row)},onLabelMouseover:function(){this.draggable=!0},onLabelMouseout:function(){this.draggable=!1},onRowDragstart:function(t){t.dataTransfer.setData("text","element"),t.dataTransfer.effectAllowed="move",this.dragging=!0,this.$emit("row-dragstart",this.row)},onRowDragend:function(t){this.dragging=!1,this.$emit("row-dragend",this.row)},onRowDrop:function(t){this.dragging=!1,this.$emit("row-drop",this.row)},onFocus:function(){this.focus=!0},onBlur:function(){this.focus=!1}}},separator:k,listSeparator:P},data:function(){return{droppingRow:null}},mixins:[T],methods:{addRow:function(){var e=t();console.log(e),this.item.rows.push({component:"row",text:null,id:e}),console.log(this.item.rows)},deleteRow:function(t){if(t.text&&!confirm("行を削除します。よろしいですか？"))return!1;var e=this.item.rows.indexOf(t);if(-1===e)return!1;this.item.rows.length<=1?this.item.rows[0].text=null:this.item.rows.splice(e,1)},onRowDragstart:function(t){this.droppingRow=t},onRowDragend:function(t){this.droppingRow=null},onRowDrop:function(t){if(!this.droppingRow)return!1;var e=t?this.item.rows.indexOf(t)+1:0,i=this.item.rows.indexOf(this.droppingRow);if(this.droppingRow=null,e===i||e===i+1)return!1;var o=this.item.rows.splice(i,1);e=t?this.item.rows.indexOf(t)+1:0,this.item.rows.splice(e,0,o[0])}}},F={template:'    <div class="table-menu" v-bind:class="[data.direction,{show: data.show}]" ref="tableMenu">      <ul>        <li v-bind:class="{show: data.mode==\'col\'}" v-on:click="onMenuClick" data-action="insert-left">左に列を挿入</li>        <li v-bind:class="{show: data.mode==\'col\'}" v-on:click="onMenuClick" data-action="insert-right">右に列を挿入</li>        <li v-bind:class="{show: data.mode==\'row\'}" v-on:click="onMenuClick" data-action="insert-above">上に行を挿入</li>        <li v-bind:class="{show: data.mode==\'row\'}" v-on:click="onMenuClick" data-action="insert-below">下に行を挿入</li>        <li v-bind:class="{show: data.mode==\'row\'}" v-on:click="onMenuClick" data-action="header-row">行を見出しにする</li>        <li v-bind:class="{show: data.mode==\'col\'}" v-on:click="onMenuClick" data-action="header-col">列を見出しにする</li>        <li v-bind:class="{show: data.mode==\'row\'}" v-on:click="onMenuClick" data-action="de-header-row">行の見出しを解除</li>        <li v-bind:class="{show: data.mode==\'col\'}" v-on:click="onMenuClick" data-action="de-header-col">列の見出しを解除</li>        <li v-bind:class="{show: data.mode==\'row\'}" v-on:click="onMenuClick" data-action="delete-row">行を削除</li>        <li v-bind:class="{show: data.mode==\'col\'}" v-on:click="onMenuClick" data-action="delete-col">列を削除</li>      </ul>    </div>',props:["data"],methods:{onMenuClick:function(t){var e=$(t.target).attr("data-action");this.$emit("menu-click",e)}}},_={template:'  <div class="item-wrap">    <div class="item table" v-bind:class="">      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">表組み</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <div class="size">          <label>横</label><input v-model="colNumInput" type="text"> × <label>縦</label><input v-model="rowNumInput" type="text"><button tabindex="-1" class="apply" v-on:click.prevent="applyChange">適用</button>        </div>        <div class="table-wrap">          <table ref="table">            <thead>              <tr>                <th></th>                <colHeader                   v-for="col in colNum"                  v-bind:colNo=col                  :key="col"                  v-on:menu-click="onColMenuClick"                  v-on:col-dragstart="onColDragstart"                  v-on:col-dragend="onColDragend"                  v-on:col-dragover="onColDragover">              </tr>            </thead>            <tbody>              <row                 v-for="(row, index) in item.rows"                v-bind:row=row :key="row"                v-on:editstart="onEditStart"                v-on:dragover.prevent.stop="onDragover"                v-on:row-menu-click="onRowMenuClick"                v-on:row-dragstart="onRowDragstart"                v-on:row-dragend="onRowDragend"                v-on:row-dragover="onRowDragover"                 />            </tbody>          </table>          <div class="col-button-wrap"><button class="add add-col" v-on:click.prevent="addCol()" v-bind:disabled="isMaxCol">列</button></div>          <div class="line-selection" ref="lineSelection"></div>          <div class="insert-line" ref="insertLine"></div>          <div class="dragging-selection" ref="draggingSelection"></div>        </div>        <button class="add add-row" v-on:click.prevent="addRow()" v-bind:disabled="isMaxRow">行</button>      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <component      class="table-ve"      v-bind:is="inputComponent"      v-bind:isPlaceholderEnabled=false      v-bind:text=item.text      v-on:input="onTextChange"      v-on:ve-init="onVEInit"      ref="celleditor" />    <div class="ve-overlay" v-on:click="onEditEnd" ref="veOverlay"></div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],components:{row:{template:'  <tr     v-bind:draggable="draggable"    v-on:dragstart="onDragstart"    v-on:dragover="onDragover"    v-on:dragend="onDragend">    <th       v-bind:class="{dragging:dragging}"      v-on:mouseover="onMouseover"      v-on:mouseout="onMouseout"><div class="menu row-menu" v-on:click.prevent.stop="onMenuClick"></div></th>    <column      v-for="(col, index) in row.cols"      v-bind:col=col      v-on:editstart="onEditStart"      :key="col" />  </tr>',props:["row","droppingRow"],components:{listSeparator:P,column:{template:'  <td     class="ve-style"    v-bind:class="{header: col.header}"    v-on:click="onClick"    ref="inputElement"></td>  ',props:["col"],mounted:function(){var t=$(this.$refs.inputElement);this.col.text?t.html(this.col.text):t.html("<br>")},watch:{"col.text":function(t){$(this.$refs.inputElement).html(t)}},methods:{onClick:function(){this.$emit("editstart",this.col)}}}},data:function(){return{dragging:!1,draggable:!1}},methods:{onEditStart:function(t){this.$emit("editstart",this.row,t)},onMenuClick:function(t){this.$emit("row-menu-click",this.row,t)},onMouseover:function(){this.draggable=!0},onMouseout:function(){this.draggable=!1},onDragstart:function(t){if(t.dataTransfer.setData("text","element"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage){var e=new Image;e.src=p+"img/blank.png",t.dataTransfer.setDragImage(e,0,0)}this.dragging=!0,this.$emit("row-dragstart",this.row,t)},onDragover:function(t){this.$emit("row-dragover",t)},onDragend:function(t){this.dragging=!1,this.$emit("row-dragend",this.row,t)}}},colHeader:{props:["colNo"],data:function(){return{dragging:!1,draggable:!1}},template:'    <th      v-bind:draggable="draggable"      v-bind:class="{dragging:dragging}"      v-on:dragstart="onDragstart"      v-on:dragover="onDragover"      v-on:dragend="onDragend"      v-on:mouseover="onMouseover"      v-on:mouseout="onMouseout">      <div         class="menu col-menu"        v-on:click.prevent.stop="onMenuClick(colNo-1,$event)"></div>    </th>',methods:{onMenuClick:function(t,e){this.$emit("menu-click",t,e)},onMouseover:function(){this.draggable=!0},onMouseout:function(){this.draggable=!1},onDragstart:function(t){if(t.dataTransfer.setData("text","element"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage){var e=new Image;e.src=p+"img/blank.png",t.dataTransfer.setDragImage(e,0,0)}this.dragging=!0,this.$emit("col-dragstart",this.colNo-1,t)},onDragend:function(t){this.dragging=!1,this.$emit("col-dragend",this.colNo-1,t)},onDragover:function(t){this.$emit("col-dragover",t)}}},visualeditor:E,plaintexteditor:N,separator:k},data:function(){return{inputComponent:g.options.inlineVe?"visualeditor":"plaintexteditor",prevDraggingTime:0,colNumInput:g.options.tableDefaultColNum,rowNumInput:1,actionPos:0,isDraggingRow:!1,isDraggingCol:!1,dropRowPos:-1,dropColPos:-1,editingCol:null}},created:function(){this.item.rows&&0!=this.item.rows.length||this.addRow(),this.syncInput();(new Image).src=p+"img/blank.png"},mounted:function(){$(this.$refs.celleditor.$el).hide();$(this.$el).on("click","a",function(t){t.stopPropagation(),t.preventDefault()})},mixins:[T],computed:{rowNum:function(){return this.item.rows?this.item.rows.length:0},colNum:function(){return this.item.rows&&0!=this.item.rows.length?this.item.rows[0].cols.length:0},isMaxRow:function(){return this.rowNum>=g.options.tableMaxRow},isMaxCol:function(){return this.colNum>=g.options.tableMaxCol}},methods:{applyChange:function(){if(this.rowNumInput=parseInt(String(this.rowNumInput).replace(/[０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})),this.colNumInput=parseInt(String(this.colNumInput).replace(/[０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})),this.rowNumInput<=0||this.rowNumInput>g.options.tableMaxRow)return alert("テーブルの行数は 1〜"+g.options.tableMaxRow+" の範囲で設定可能です"),!1;if(this.colNumInput<=0||this.colNumInput>g.options.tableMaxCol)return alert("テーブルの列数は 1〜"+g.options.tableMaxCol+" の範囲で設定可能です"),!1;if(this.rowNumInput||(this.rowNumInput=1),this.colNumInput||(this.colNumInput=g.options.tableDefaultColNum),(this.rowNum>this.rowNumInput||this.colNum>this.colNumInput)&&!confirm("現在の入力エリアよりも縮小するため、データが失われます。よろしいですか？"))return!1;if(this.rowNumInput>this.rowNum)for(var t=this.rowNumInput-this.rowNum,e=0;e<t;e++)this.addRow(null);else if(this.rowNumInput<this.rowNum)for(var t=this.rowNum-this.rowNumInput,e=0;e<t;e++)this.deleteRow(null);if(this.colNumInput>this.colNum)for(var t=this.colNumInput-this.colNum,e=0;e<t;e++)this.addCol(null);else if(this.colNumInput<this.colNum)for(var t=this.colNum-this.colNumInput,e=0;e<t;e++)this.deleteCol(null)},onTextChange:function(t){},onVEInit:function(){},onEditStart:function(t,e){var i=$(this.$refs.celleditor.$el),o=$(this.$refs.veOverlay),n=$(this.$refs.table),a=$(g.vue.$el),s=this.rowIndex(t),r=this.colIndex(e);if(s<0||r<0)return!1;var l=n.find("tbody tr").eq(s),d=l.find("td").eq(r),c=d.width(),p=d.outerHeight()-2,u=d.offset().left-a.offset().left,m=l.offset().top-a.offset().top;p<80&&(p=80),i.width(c).css({left:u+"px",top:m+"px",minHeight:p+"px"}).html(e.text).show(),setTimeout(function(){i.trigger("focus")},0),o.show(),a.append(o).append(i),this.editingCol=e},onEditEnd:function(t){if(!this.editingCol)return!1;var e=$(this.$refs.celleditor.$el),i=$(this.$refs.veOverlay),o=$(this.$el);this.editingCol.text=e.html(),e.trigger("blur").hide(),i.hide(),o.append(e).append(i),this.editingCol=null},onRowMenuClick:function(t,e){for(var i=null,o=0;o<this.rowNum;o++)t==this.item.rows[o]&&(i=o,this.onMenuClick(i,"row",e));null!=i&&this.showLineSelection("row",i)},onColMenuClick:function(t,e){this.onMenuClick(t,"col",e),this.showLineSelection("col",t)},onMenuClick:function(t,e,i){this.actionPos=t,this.$emit("table-header-menu-click",this,e,i)},doAction:function(t){switch(t){case"insert-left":this.addCol(this.actionPos);break;case"insert-right":this.addCol(this.actionPos+1);break;case"insert-above":this.addRow(this.actionPos);break;case"insert-below":this.addRow(this.actionPos+1);break;case"delete-row":confirm("行を削除します。よろしいですか?")&&this.deleteRow(this.actionPos);break;case"delete-col":confirm("列を削除します。よろしいですか?")&&this.deleteCol(this.actionPos);break;case"header-row":this.headerRow(this.actionPos,!0);break;case"header-col":this.headerCol(this.actionPos,!0);break;case"de-header-row":this.headerRow(this.actionPos,!1);break;case"de-header-col":this.headerCol(this.actionPos,!1)}this.showLineSelection()},addRow:function(t){if(this.item.rows.length>=g.options.tableMaxRow)return!1;null==t&&(t=this.rowNum);for(var e=[],i=this.colNum?this.colNum:g.options.tableDefaultColNum,o=0;o<i;o++)e.push({text:"",header:this.isHeaderCol(o)});this.item.rows||(this.item.rows=[]),this.item.rows.splice(t,0,{cols:e}),this.syncInput("row")},addCol:function(t){if(this.item.rows&&this.item.rows[0].cols.length>=g.options.tableMaxCol)return!1;null==t&&(t=this.colNum);for(var e=this.item.rows.length,i=[],o=0;o<e;o++)i[o]=this.isHeaderRow(o);for(o=0;o<e;o++){this.item.rows[o].cols.splice(t,0,{text:"",header:i[o]})}this.syncInput("col")},deleteRow:function(t){null==t&&(t=this.rowNum-1),this.item.rows.splice(t,1),0==this.rowNum&&this.addRow(null),this.syncInput("row")},deleteCol:function(t){null==t&&(t=this.colNum-1);for(var e=0;e<this.rowNum;e++)this.item.rows[e].cols.splice(t,1);0==this.colNum&&this.addCol(null),this.syncInput("col")},headerRow:function(t,e){for(var i=0;i<this.colNum;i++)0==e&&this.isHeaderCol(i)||(this.item.rows[t].cols[i].header=e)},headerCol:function(t,e){for(var i=0;i<this.rowNum;i++)0==e&&this.isHeaderRow(i)||(this.item.rows[i].cols[t].header=e)},isHeaderRow:function(t){for(var e=0,i=0;i<this.colNum;i++)this.item.rows[t].cols[i].header&&e++;return this.colNum>0&&this.colNum==e},isHeaderCol:function(t){for(var e=0,i=0;i<this.rowNum;i++)this.item.rows[i].cols[t].header&&e++;return this.rowNum>0&&this.rowNum==e},syncInput:function(t){"row"==t?this.rowNumInput=this.rowNum:"col"==t?this.colNumInput=this.colNum:(this.colNumInput=this.colNum,this.rowNumInput=this.rowNum)},showLineSelection:function(t,e){var i=$(this.$refs.lineSelection),o=$(this.$refs.table);if(void 0===t)i.hide();else if("row"==t){var n=o.find("tr").eq(e+1),a=o.position().left+n.position().left,s=o.position().top+n.position().top;i.show().width(n.outerWidth()-1).height(n.outerHeight()-1).css({left:a+"px",top:s+"px"})}else if("col"==t){var r=o.find("tr").eq(0).find("th").eq(e+1),a=o.position().left+r.position().left,s=o.position().top;i.show().width(r.outerWidth()-1).height(o.outerHeight()-2).css({left:a+"px",top:s+"px"})}},onRowDragstart:function(t,e){var i=$(this.$refs.insertLine),o=$(this.$refs.draggingSelection),n=$(this.$refs.table);$(this.$el);if(i.show().width(n.width()).height("2px").css({left:n.position().left+"px"}),e.dataTransfer.setDragImage){for(var a=-1,s=0;s<this.rowNum;s++)if(this.item.rows[s]==t){a=s;break}var r=n.find("tbody tr").eq(a).outerHeight(),l=n.position().left+n.find("thead tr th").eq(0).outerWidth();o.show().width(n.width()-n.find("thead tr th").eq(0).outerWidth()).height(r).css({left:l+"px"})}this.isDraggingRow=!0,this.onRowDragover(e)},onRowDragover:function(t){if(this.isDraggingRow){var e=(new Date).getTime();if(!(e-this.prevDraggingTime<20)){this.prevDraggingTime=e;var i,o=$(this.$refs.insertLine),n=$(this.$refs.table),a=$(this.$refs.draggingSelection),s=this.draggingRowPosition(t);i=s>=this.rowNum?n.position().top+n.find("tbody tr").eq(s-1).offset().top-n.offset().top+n.find("tbody tr").eq(s-1).outerHeight():n.position().top+n.find("tbody tr").eq(s).offset().top-n.offset().top,o.css({top:i+"px"}),i=n.position().top+t.pageY-n.offset().top-a.height()/2,a.css({top:i+"px"}),this.dropRowPos=s}}},onRowDragend:function(t,e){$(this.$refs.insertLine).hide();$(this.$refs.draggingSelection).hide();for(var i=this.dropRowPos,o=-1,n=0;n<this.rowNum;n++)if(this.item.rows[n]==t){o=n;break}-1!=o&&o!=i&&(this.item.rows.splice(o,1),i>o&&i--,this.item.rows.splice(i,null,t),this.isDraggingRow=!1)},draggingRowPosition:function(t){var e=this,i=$(this.$refs.table),o=-1;return $first_row=i.find("tbody tr").eq(0),$last_row=i.find("tbody tr").eq(this.rowNum-1),i.find("tbody tr").each(function(i){var n=$(this),a=n.offset().top,s=n.outerHeight(),r=a+s;a<t.pageY&&t.pageY<r?(a+s/2>=t.pageY&&(o=i),a+s/2<t.pageY&&(o=i+1)):t.pageY<=$first_row.offset().top?o=0:t.pageY>=$last_row.offset().top+$last_row.outerHeight()&&(o=e.rowNum)}),o},onColDragstart:function(t,e){var i=$(this.$refs.insertLine),o=$(this.$refs.draggingSelection),n=$(this.$refs.table);if(i.show().height(n.height()).width(2).css({top:n.position().top+"px"}),e.dataTransfer.setDragImage){var a=n.find("thead tr th").eq(t+1).outerWidth(),s=n.outerHeight()-n.find("thead tr").eq(0).outerHeight()-2,r=n.position().top+n.find("thead tr th").eq(0).outerHeight();o.show().width(a).height(s).css({top:r+"px"})}this.isDraggingCol=!0,this.onColDragover(e)},onColDragover:function(t){if(this.isDraggingCol){var e=(new Date).getTime();if(!(e-this.prevDraggingTime<20)){this.prevDraggingTime=e;var i,o=$(this.$refs.insertLine),n=$(this.$refs.table),a=$(this.$refs.draggingSelection),s=this.draggingColPosition(t);i=s>=this.colNum?n.position().left+n.find("thead tr th").eq(this.colNum).position().left+n.find("thead tr th").eq(this.colNum-1).outerWidth():n.position().left+n.find("thead tr th").eq(s+1).offset().left-n.offset().left,o.css({left:i+"px"}),i=n.position().left+t.pageX-n.offset().left-a.width()/2,a.css({left:i+"px"}),this.dropColPos=s}}},onColDragend:function(t,e){$(this.$refs.insertLine).hide();$(this.$refs.draggingSelection).hide();var i=this.dropColPos,o=t;if(d({src_pos:o,dest_pos:i}),-1!=o&&o!=i){i>o&&i--;for(var n=0;n<this.rowNum;n++){var a=this.item.rows[n].cols,s=a.splice(o,1);a.splice(i,null,s[0])}this.isDraggingCol=!1}},draggingColPosition:function(t){var e=this,i=$(this.$refs.table),o=-1;return $first_col=i.find("thead tr th").eq(1),$last_col=i.find("thead tr th").eq(this.colNum),i.find("thead th").each(function(i){var n=$(this),a=n.offset().left,s=n.outerWidth(),r=a+s;a<t.pageX&&t.pageX<r?a+s/2>=t.pageX?o=i:a+s/2<t.pageX&&(o=i+1):t.pageX<=$first_col.offset().left?o=1:t.pageX>=$last_col.offset().left+$last_col.outerWidth()&&(o=e.colNum+1)}),o>0&&o--,o},rowIndex:function(t){if(0==this.rowNum)return-1;for(var e=0;e<this.rowNum;e++)if(this.item.rows[e]==t)return e;return-1},colIndex:function(t){if(0==this.rowNum)return-1;for(var e=0;e<this.rowNum;e++)for(var i=this.item.rows[e],o=0;o<this.colNum;o++)if(i.cols[o]==t)return o;return-1}}},U={template:'  <div class="item-wrap">    <div class="item html" v-bind:class="[item.type, {dragging:dragging}]">      <div class="col1">        <label v-on:dragstart="onLabelDragstart" v-on:dragend="onLabelDragend" draggable="true">HTML</label>      </div>      <div class="col2">        <div class="class-wrap" v-if="isCssClassEnabled">          <label :for="item.id+\'_css\'">CSSクラス</label>          <input type="text" v-model="item.className" :id="item.id+\'_css\'" />        </div>        <textarea v-model="item.html" v-on:input="onInput" ref="inputElement" />      </div>      <div class="col3"><button v-on:click.prevent="onItemDelete" tabindex="-1"><span>削除</span></button></div>    </div>    <separator v-on:label-drop-on-separator="onLabelDrop" v-on:separator-click="onSeparatorClick" />  </div>',props:["item"],components:{separator:k},mixins:[T],mounted:function(){var t=this.$refs.inputElement;if(document.createEvent){(e=document.createEvent("HTMLEvents")).initEvent("input",!0,!0),t.dispatchEvent(e)}else{var e=document.createEventObject();t.fireEvent("oninput",e)}},computed:{labelName:function(){return g.options.typeNames[this.item.type]}},methods:{onInput:function(t){var e=window.getComputedStyle(t.target),i=e.lineHeight.split("px")[0];e.paddingTop.split("px")[0],e.paddingBottom.split("px")[0];if(t.target.scrollHeight>t.target.offsetHeight)t.target.style.height=t.target.scrollHeight+3+"px";else for(var o;;){if(o=t.target.style.height.split("px")[0],t.target.style.height=o-i+"px",t.target.scrollHeight>t.target.offsetHeight){t.target.style.height=t.target.scrollHeight+3+"px";break}break}}}},q={"big-heading":{type:"big-heading",component:"textItem",id:null,text:null},"mid-heading":{type:"mid-heading",component:"textItem",id:null,text:null},"small-heading":{type:"small-heading",component:"textItem",id:null,text:null},text:{type:"text",component:"textItem",id:null,text:""},"ve-text":{component:"VETextItem",id:null,text:"",veInited:!1},image:{component:"imageItem",align:"left",image:null,text:null,id:null,veInited:!1},"image-only":{component:"imageOnlyItem",align:"left",image:null,text:null,id:null,veInited:!1},link:{component:"linkItem",url:null,text:null,id:null,newWindow:!1},list:{component:"listItem",rows:[{component:"row",text:null,id:null}]},table:{component:"tableItem",rows:[],id:null},html:{component:"htmlItem",html:null,id:null}},A=m.val(),j=m.attr("name"),W=[],V=$("<div></div>");V.html(A),V.find("."+g.options.wholeWrapTagClass).children().each(function(){var e=$(this),o=e.html(),a=e[0].tagName.toUpperCase();if(a===g.options.bigHeadingTag.toUpperCase()||a===g.options.midHeadingTag.toUpperCase()||a===g.options.smallHeadingTag.toUpperCase()||a===g.options.textTag.toUpperCase()&&!g.options.inlineVe){var s;if(g.options.types.indexOf("big-heading")>=0&&a===g.options.bigHeadingTag.toUpperCase()?s="big-heading":g.options.types.indexOf("mid-heading")>=0&&a===g.options.midHeadingTag.toUpperCase()?s="mid-heading":g.options.types.indexOf("small-heading")>=0&&a===g.options.smallHeadingTag.toUpperCase()?s="small-heading":g.options.types.indexOf("text")>=0&&a===g.options.textTag.toUpperCase()&&(s="text"),-1===g.options.types.indexOf(s))return;o=function(t){return t?t.replace(/<br(\s*\/)?>/g,"\n"):t}(o),g.options.allowHtmlInText||(o=n(o));if((d=l(q[s])).id=t(),d.text=o,g.options.allowCssClass){(v=e.attr("class"))&&(d.className=v.trim())}W.push(d)}else if(a===g.options.textTag.toUpperCase()&&g.options.inlineVe){if(-1===g.options.types.indexOf("text"))return;if((d=l(q["ve-text"])).id=t(),d.text=o,g.options.allowCssClass){(v=e.attr("class"))&&(d.className=v.trim())}W.push(d)}else if(a===g.options.imageTag.toUpperCase()&&e.hasClass(g.options.imageTagClass)){if(-1===g.options.types.indexOf("image"))return;var r=e.find(".img").eq(0),d=l(q.image);if(r.length){r.hasClass("img-left")&&(d.align="left"),r.hasClass("img-right")&&(d.align="right"),r.hasClass("img-center")&&(d.align="center");(u=r.find("img").eq(0))&&(d.image=u.attr("src"));var c=e.find(".text").eq(0),p=null;if(c.length){p=c.html();!g.options.inlineVe&&g.options.allowHtmlInText&&(p=i(p)),p=p.replace(/&lt;br(\s*\/)?&gt;/g,"<br>"),d.text=p}}if(g.options.allowCssClass){(v=e.attr("class"))&&(v=v.replace(g.options.imageTagClass,"").trim()),v&&(d.className=v)}if(g.options.allowImageAlt){m=u.attr("alt");d.altName=m||null}d.id=t(),W.push(d)}else if(a===g.options.imageTag.toUpperCase()&&e.hasClass(g.options.imageOnlyTagClass)){if(-1===g.options.types.indexOf("image-only"))return;var d=l(q["image-only"]),u=e.find("img").eq(0);if(u&&(d.image=u.attr("src")),g.options.allowCssClass){(v=e.attr("class"))&&(v=v.replace(g.options.imageTagClass,"").trim()),v&&(d.className=v)}if(g.options.allowImageAlt){var m=u.attr("alt");d.altName=m||null}d.id=t(),W.push(d)}else if(a===g.options.linkTag.toUpperCase()&&e.hasClass(g.options.linkTagClass)){if(-1===g.options.types.indexOf("link"))return;if((d=l(q.link)).url=e.find("a").eq(0).attr("href"),d.text=e.find("a").eq(0).text(),d.newWindow="_blank"===e.find("a").eq(0).attr("target"),d.id=t(),g.options.allowCssClass){(v=e.attr("class"))&&(v=v.replace(g.options.linkTagClass,"").trim()),v&&(d.className=v)}W.push(d)}else if(a===g.options.listTag.toUpperCase()){if(-1===g.options.types.indexOf("list"))return;var d=l(q.list),h=[];if(e.find("li").each(function(){$e=$(this);var e;e=g.options.allowHtmlInText?$e.html():$e.text(),h.push({component:"row",text:e,id:t()})}),0===h.length&&(d.rows[0].id=t(),h=d.rows),d.rows=h,d.id=t(),g.options.allowCssClass){(v=e.attr("class"))&&(d.className=v.trim())}W.push(d)}else if(a===g.options.tableTag.toUpperCase()){if(-1===g.options.types.indexOf("table"))return;var d=l(q.table),h=[];if(e.find("tr").each(function(){var t={cols:[]};$(this).find("th,td").each(function(){var e=$(this).html();!g.options.inlineVe&&g.options.allowHtmlInText&&(e=i(e));var o={text:e=e.replace(/&lt;br(\s*\/)?&gt;/g,"<br>")};"TH"==$(this)[0].tagName.toUpperCase()?o.header=!0:o.header=!1,t.cols.push(o)}),h.push(t)}),d.rows=h,d.id=t(),g.options.allowCssClass){(v=e.attr("class"))&&(d.className=v.trim())}W.push(d)}else if(a===g.options.htmlTag.toUpperCase()&&e.hasClass(g.options.htmlTagClass)){if(-1===g.options.types.indexOf("html"))return;d=l(q.html);if(g.options.allowCssClass){var v=e.attr("class");v&&(v=v.replace(g.options.htmlTagClass,"").trim()),v&&(d.className=v)}d.html=e.html(),d.id=t(),W.push(d)}}),this.getSendData=function(){for(var t="",e=0;e<W.length;e++){var s=W[e];if("textItem"===s.component){d=o(d=s.text);if(g.options.allowHtmlInText||(d=i(d)),!(d=function(t){return t?t.replace(/(\r\n|\r|\n)/g,"<br>"):t}(d)))continue;var r=g.options.textTag;"big-heading"===s.type?r=g.options.bigHeadingTag:"mid-heading"===s.type?r=g.options.midHeadingTag:"small-heading"===s.type?r=g.options.smallHeadingTag:"text"===s.type&&(r=g.options.textTag);w="";g.options.allowCssClass&&s.className&&(w=' class="'+i(s.className.trim())+'"'),t+="<"+r+w+">"+d+"</"+r+">\n"}else if("VETextItem"===s.component){if(!(d=a(s.text)))continue;w="";g.options.allowCssClass&&s.className&&(w=' class="'+i(s.className.trim())+'"'),t+="<"+g.options.textTag+w+">\n"+d+"\n</"+g.options.textTag+">\n"}else if("imageItem"===s.component){if(!s.image)continue;d=a(s.text);!g.options.inlineVe&&g.options.allowHtmlInText&&(d=n(d));w="";g.options.allowCssClass&&s.className&&(w=" "+i(s.className.trim()));l="";g.options.allowImageAlt&&s.altName&&(l=' alt="'+i(s.altName)+'"'),t+="<"+g.options.imageTag+' class="'+g.options.imageTagClass+w+'">\n<p class="img img-'+s.align+'"><img src="'+s.image+'" title="'+s.image+'"'+l+' /></p>\n<p class="text">'+d+"</p>\n</"+g.options.imageTag+">\n"}else if("imageOnlyItem"===s.component){if(!s.image)continue;w="";g.options.allowCssClass&&s.className&&(w=" "+i(s.className.trim()));var l="";g.options.allowImageAlt&&s.altName&&(l=' alt="'+i(s.altName)+'"'),t+="<"+g.options.imageTag+' class="'+g.options.imageOnlyTagClass+w+'">\n<img src="'+s.image+'" title="'+s.image+'"'+l+" /></"+g.options.imageTag+">\n"}else if("linkItem"===s.component){if(!s.url)continue;var d,c=i(s.url);(d=i(s.text))||(d=c);w="";g.options.allowCssClass&&s.className&&(w=" "+i(s.className.trim())),t+="<"+g.options.linkTag+' class="'+g.options.linkTagClass+w+'">\n<a href="'+c+'"'+(s.newWindow?' target="_blank" rel="noopener"':"")+">"+d+"</a>\n</"+g.options.linkTag+">\n"}else if("listItem"===s.component){var p="";if(s.rows.forEach(function(t){if(t.text){var e=t.text;g.options.allowHtmlInText||(e=i(e)),p+="<li>"+e+"</li>\n"}}),p){w="";g.options.allowCssClass&&s.className&&(w=' class="'+i(s.className.trim())+'"'),t+="<"+g.options.listTag+w+">\n"+p+"</"+g.options.listTag+">\n"}}else if("tableItem"===s.component){var u="",m="",h="",v=0;if(s.rows.forEach(function(t){var e=[],i=0,o=0,s="";if(t.cols.forEach(function(t){var e=a(t.text);t.header&&i++,e||o++}),t.cols.length!=o){s=t.cols.length==i?"col":"row",t.cols.forEach(function(t){var i=a(t.text);!g.options.inlineVe&&g.options.allowHtmlInText&&(i=n(i)),t.header?e.push('<th scope="'+s+'">'+i+"</th>\n"):e.push("<td>"+i+"</td>\n")});var r="";r+="<tr>\n",r+=e.join(""),r+="</tr>\n",0==v&&"col"==s?m+=r:h+=r,v++}}),m&&(u+="<thead>\n"+m+"</thead>\n"),h&&(u+="<tbody>\n"+h+"</tbody>\n"),u){w="";g.options.allowCssClass&&s.className&&(w=' class="'+i(s.className.trim())+'"'),t+="<"+g.options.tableTag+w+">\n"+u+"</"+g.options.tableTag+">\n"}}else if("htmlItem"===s.component){var f=s.html;if(!(f=o(f)))continue;var w="";g.options.allowCssClass&&s.className&&(w=" "+i(s.className.trim())),t+="<"+g.options.htmlTag+' class="'+g.options.htmlTagClass+w+'">'+f+"</"+g.options.htmlTag+">\n"}}return t&&(t="<"+g.options.wholeWrapTag+' class="'+g.options.wholeWrapTagClass+'">\n'+t+"</"+g.options.wholeWrapTag+">\n"),t};var B=[];"undefined"==typeof Vue&&B.push([p+"lib/vue/vue.min.js"]),B.length?r(B,function(){u()},function(){alert("ライブラリの読み込みに失敗しました")}):u()},v=null;h.showUploader=function(t,e,i,o){if(v)return!1;var n=e;(t=t||"")&&(n=t+n),i&&(n+="#"+i),(v=$('<div class="article-editor-overlay"><div class="uploader"><button class="close"><i class="fa fa-times" aria-hidden="true"></i></button><iframe src="'+n+'"></iframe></div></div>')).addClass("active").bind("click",h.hideUploader),$("body").append(v),window.selectUploadFile||(window.selectUploadFile=function(e){o&&o(t+e),h.hideUploader()}),window.onmessage||(window.onmessage=function(e){try{var i=JSON.parse(e.data);void 0!==i.path&&o&&o(t+i.path)}catch(e){}h.hideUploader()})},h.hideUploader=function(){if(!v)return!1;v.removeClass("active"),window.selectUploadFile=null,window.onmessage=null,setTimeout(function(){v.remove(),v=null},500)},h.upload=function(t,e,i,o,n,a){var s=new FormData;s.append("dir",i),s.append("action","upload"),s.append("upload",t);var r=new XMLHttpRequest;r.open("POST",e),r.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest"),r.onreadystatechange=function(t){if(r.readyState===XMLHttpRequest.DONE&&200===r.status)try{var e=JSON.parse(r.response);if(e.errors)return n&&n(e.errors),!1;o&&o(e.result.files[0].web_path)}catch(t){n&&n("不正なデータを受信しました")}},r.upload.onprogress=function(t){a&&a(t.loaded/t.total)},r.send(s)};var f=[];return function(t,e){if(!g)return alert("[ArticleEditor] お使いのブラウザはサポートされていません"),null;var i=this,o=function(){if(i.instances=[],t instanceof HTMLElement){var o=new h(t,e);i.instances.push(o)}else $(t).each(function(){var t=new h($(this)[0],e);i.instances.push(t)})};"undefined"==typeof jQuery?r([p+"lib/jquery/jquery.min.js"],function(){o()}):o()}}();