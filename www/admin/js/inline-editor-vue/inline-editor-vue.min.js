var InlineEditor=function(){function t(t){var e=document.getElementsByTagName("head").item(0),n=document.createElement("link");n.rel="stylesheet",n.href=t,n.type="text/css",e.appendChild(n)}function e(t,e,n){"string"==typeof t&&(t=[t]);var i=[];if(t.forEach(function(e){-1===l.indexOf(t)&&i.push(e)}),0!==i.length){var o=setTimeout(function(){n&&n()},5e3),r=0;i.forEach(function(n){var s=document.getElementsByTagName("head").item(0),u=document.createElement("script");u.src=n,s.appendChild(u),l.push(n),u.onload=function(){++r===i.length&&(clearTimeout(o),e&&e(t));var a=l.indexOf(n);-1!==a&&l.splice(a,1),u.onload=null,s&&u.parentNode&&s.removeChild(u)}})}else e&&e()}var n=function(){var t;if(document.currentScript)t=document.currentScript.src;else{var e=document.getElementsByTagName("script");t=(t=e[e.length-1]).src}if(t&&t.match(/^(.+?)([^\/]+?)$/))return RegExp.$1}(),i=window.File&&window.FileReader&&window.FileList&&window.Blob,o=function(){var t=window.navigator.userAgent.toLowerCase();return-1!==t.indexOf("edge")?"edge":-1!==t.indexOf("iemobile")?"iemobile":-1!==t.indexOf("trident/7")?"ie":-1!==t.indexOf("msie")&&-1===t.indexOf("opera")?"ie":-1!==t.indexOf("chrome")&&-1===t.indexOf("edge")?"chrome":-1!==t.indexOf("safari")&&-1===t.indexOf("chrome")?"safari":-1!==t.indexOf("opera")?"opera":-1!==t.indexOf("firefox")?"firefox":null}(),r=("edge"==o||"chrome"==o||"safari"==o||"firefox"==o||"ie"==o&&function(){var t=window.navigator.userAgent.toLowerCase(),e=window.navigator.appVersion.toLowerCase();if(-1!==t.indexOf("trident/7"))return 11;if(-1!==t.indexOf("msie")&&-1===t.indexOf("opera")){if(-1!==e.indexOf("msie 6."))return 6;if(-1!==e.indexOf("msie 7."))return 7;if(-1!==e.indexOf("msie 8."))return 8;if(-1!==e.indexOf("msie 9."))return 9;if(-1!==e.indexOf("msie 10."))return 10}return null}()>=10)&&i;t(n+"css/style.css"),t(n+"css/ve.css");var s=function(t,i){function o(){s.vue||(s.vue=new Vue({el:t,template:'        <div class="inline-editor">          <visualeditor v-bind:value="inputValue" v-on:input="onTextChange" />          <input v-bind:name="inputName" type="hidden" ref="sendData" />        </div>',data:function(){return{inputName:null,inputValue:null}},components:{visualeditor:h},created:function(){this.inputName=p,this.inputValue=f},mounted:function(){var t=u(this.$el).closest("form"),e=this;t&&t.bind("submit",function(t){var n=e.inputValue;u(e.$refs.sendData).value(n)}),s.options.onLoad&&s.options.onLoad.call(s)},methods:{onTextChange:function(t){this.inputValue=t}}}))}var r=u(t);if(!r.closest("form"))return alert("[InlineEditor] 指定の要素:("+selector+") がフォーム要素に含まれないため、正常に動作しません"),null;var s=this,l={veStyleFormats:[],placeholder:null,onLoad:null,uploaderPath:"/uploader",uploaderDir:"/"};this.options=function(t){var e={};for(var n in t)e[n]=t[n];return e}(l);for(var a in i)this.options[a]=i[a];for(var a in l){var c="data-"+function(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.charAt(0).toLowerCase()})}(a),d=r.attr(c);if(d){d=d.replace(/\'/g,'"');try{d=JSON.parse(d)}catch(t){}finally{this.options[a]=d}}}this.options.uploaderPath.match(/\/$/)||(this.options.uploaderPath=this.options.uploaderPath+"/"),this.options.uploaderDir.match(/^(\/*)(.*?)(\/*)$/)&&(this.options.uploaderDir=RegExp.$2),this.options.uploaderDomain&&this.options.uploaderDomain.match(/^(.*?)(\/*)$/)&&(this.options.uploaderDomain=RegExp.$1);var h={template:'<div class="ve-field" v-bind:class="{inited: veInited, placeholded: placeholded}" contenteditable="false" v-on:input="onTextChange" v-on:focus="onFocus" v-on:blur="onBlur" ref="inputElement"></div>',props:["value"],data:function(){return{placeholded:!1,veInited:!1}},created:function(){},mounted:function(){var t=u(this.$refs.inputElement);this.value?t.html(this.value):t.html("<br>"),this.loadTinyMCE(),t.trigger("blur")},methods:{init:function(){var t=this,e="undo redo | link unlink | removeformat",n=s.options.veStyleFormats;n.length&&(e="styleselect link unlink | removeformat"),console.log(e);var i=0,o=setInterval(function(){if("undefined"!=typeof tinymce){var r=s.options.uploaderPath;s.options.uploaderDir&&(r+="#"+s.options.uploaderDir),tinymce.init({target:t.$el,theme:"inlite",skin:"custom",language:"ja",menubar:!1,statusbar:!1,plugins:"link paste",insert_toolbar:"",selection_toolbar:e,inline:!0,paste_as_text:!0,paste_data_images:!1,forced_root_block:!1,keep_styles:!1,hidden_input:!1,content_css:[],branding:!1,elementpath:!1,style_formats:n,convert_urls:!1,relative_urls:!0,init_instance_callback:function(e){clearInterval(o),t.veInited=!0},file_browser_callback:function(t,e,n,i){return tinymce.activeEditor.windowManager.open({file:r,title:"ファイルのアップロード・選択",width:.85*window.innerWidth,height:.75*window.innerHeight,resizable:"yes"},{setUrl:function(e){i.document.getElementById(t).value=e}}),!1}})}++i>=20&&clearInterval(o)},500)},onTextChange:function(t){var e=u(this.$refs.inputElement).html();e&&(e.match(/^\s+$/)||e.match(/^\s*(<br\s*\/?>|<br\s+[^>]+\/?>)\s*$/))&&(e=""),this.$emit("input",e)},onFocus:function(t){var e=u(this.$refs.inputElement);s.options.placeholder&&e.text()===s.options.placeholder&&(this.placeholded=!1,e.html("<br>"))},onBlur:function(t){this.onTextChange(t);var e=u(this.$refs.inputElement);s.options.placeholder&&!e.text()&&(this.placeholded=!0,setTimeout(function(){e.html(s.options.placeholder)},0))},loadTinyMCE:function(){var t=this;"undefined"==typeof tinymce?e(n+"lib/tinymce/tinymce.min.js",function(){t.init(t)}):t.init(t)}}},f=r.value(),p=r.name();if("undefined"==typeof Vue){e([n+"lib/vue/vue.min.js"],function(){o()},function(){alert("ライブラリの読み込みに失敗しました")})}else o()},l=[],u=function(t){if(t instanceof u)return t;if(!(this instanceof u))return new u(t);if(u.isHTMLDocument(t)||u.isHTMLElement(t))this.root=t;else if(u.isHTML(t)){var e=document.createElement("div");e.innerHTML=t,this.root=e.children[0]}else this.root=document.querySelector(t);return this.root?this.tagName=this.root.tagName:this.tagName=null,this};return u.prototype.hasClass=function(t){return!!this.root&&this.root.classList.contains(t)},u.prototype.addClass=function(t){return this.root?this.hasClass(t)?this:(this.root.classList.add(t),this):null},u.prototype.removeClass=function(t){return this.root?(this.root.classList.remove(t),this):null},u.prototype.append=function(t){if(!this.root)return null;var e;return e=t instanceof u?t.HTMLElement():u.HTML2Element(t),this.root.appendChild(e),this},u.prototype.remove=function(){return this.root?(this.root&&this.root.parentNode.removeChild(this.root),null):null},u.prototype.html=function(t){return this.root?void 0===t?this.root.innerHTML:(this.root.innerHTML=t,this):null},u.prototype.text=function(t){return this.root?void 0===t?this.root.textContent:(this.root.textContent=t,this):null},u.prototype.value=function(t){return this.root?void 0===t?this.root.value:(this.root.value=t,this):null},u.prototype.name=function(t){return this.root?void 0===t?this.root.name:this:null},u.prototype.findFirst=function(t){if(!this.root)return null;var e=this.root.querySelector(t);return e?new u(e):null},u.prototype.findAll=function(t){if(!this.root)return null;for(var e=this.root.querySelectorAll(t),n=[],i=0;i<e.length;i++){var o=e[i];n.push(u(o))}return n},u.prototype.closest=function(t){if(!this.root)return null;var e;["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(t){return"function"==typeof document.body[t]&&(e=t,!0)});for(var n=this.root;;){var i=n.parentNode;if(!i||void 0===i[e])break;if(i[e](t))return u(i);n=i}return null},u.prototype.attr=function(t,e){return this.root?void 0===e?this.root.getAttribute(t):(this.root.setAttribute(t,e),this):null},u.prototype.children=function(){if(!this.root)return null;for(var t=this.root.children,e=[],n=0;n<t.length;n++){var i=t[n];e.push(u(i))}return e},u.prototype.bind=function(t,e){return this.root?(this.root.addEventListener(t,e),this):null},u.prototype.unbind=function(t,e){return this.root?(this.root.removeEventListener(t,e),this):null},u.prototype.trigger=function(t){if(!this.root)return null;if(document.createEvent){return(e=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),this.root.dispatchEvent(e)}var e=document.createEventObject();return this.trigger.fireEvent(t,e)},u.prototype.HTMLElement=function(){return this.root?this.root:null},u.prototype.show=function(){return this.root?(this.root.style.display="block",this):null},u.prototype.hide=function(){return this.root?(this.root.style.display="none",this):null},u.exists=function(t,e){void 0===e&&(e="body");return!!u.findFirst(t,e)},u.HTML2Element=function(t){if(u.isHTMLElement(t))return t;var e=document.createElement("div");return e.innerHTML=t,e.children[0]},u.isHTMLElement=function(t){return t instanceof HTMLElement},u.isHTMLDocument=function(t){return"undefined"!=typeof HTMLDocument?t instanceof HTMLDocument:"undefined"!=typeof Document?t instanceof Document:void 0},u.isHTML=function(t){return t.match(/<.+?>/)},function(t,e){if(!r)return alert("[InlineEditor] お使いのブラウザはサポートされていません"),null;this.instances=[];for(var n=u("body").findAll(t,e),i=n.length,o=0;o<i;o++){var l=new s(n[o].root,e);this.instances.push(l)}}}();